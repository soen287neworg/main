<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Resources</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">
</head>
<body>

  <script>
  (function () {
    function handleLogoutClick(e) {
      e.preventDefault();
      try {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('currentUser');
      } catch (_) {}
      window.location.href = "sign_in.html";
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", function () {
        var btn = document.getElementById("logoutBtn");
        if (btn) btn.addEventListener("click", handleLogoutClick);
      });
    } else {
      var btn = document.getElementById("logoutBtn");
      if (btn) btn.addEventListener("click", handleLogoutClick);
    }
  })();
</script>

 <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
  <div class="container">
    <a class="navbar-brand fw-bold" href="administrator_hub copie.html">Admin Hub</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item"><a class="nav-link active" href="manage.html">Manage Resources</a></li>
        <li class="nav-item"><a class="nav-link" href="bookings.html">Manage Bookings</a></li>
        <li class="nav-item"><a class="nav-link" href="stats.html">View Statistics</a></li>
        <button id="logoutBtn" class="btn btn-outline-danger">Logout</button>
        <li class ="nav-item" id="admin-link" style="display: none;">
        </li>
      </ul>
      <div class="d-flex" id="navButtons"></div>
    </div>

  </div>
</nav>


      <!-- Logout button -->
      <div class="ms-auto">
        <a href="index.html" class="btn btn-outline-danger">Logout</a>
      </div>
    </div>
  </div>
</nav>

<main class="container mt-5 pt-5">
  <h1 class="text-center mb-4">Manage Resources</h1>

  <div class="card shadow-sm p-4">
    <h5>Add a new resource</h5>
    <form id="addResourceForm">
      <div class="mb-3">
        <label for="resourceId" class="form-label">Resource ID</label>
        <input type="text" class="form-control" id="resourceId" placeholder="e.g., LAB-101">
      </div>

      <div class="mb-3">
        <label for="resourceName" class="form-label">Resource Name</label>
        <input type="text" class="form-control" id="resourceName" placeholder="e.g., Study Room 101">
      </div>

      <div class="mb-3">
        <label for="resourceType" class="form-label">Resource Type</label>
        <select class="form-select" id="resourceType">
          <option value="study_room">Study Room</option>
          <option value="lab">Lab</option>
          <option value="sports">Sports Space</option>
          <option value="equipment">Specialized Equipment</option>
          <option value="software">Software Seat</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Working Hours</label>
        <input type="text" class="form-control" id="workingHours" placeholder="e.g. 9 AM - 21 PM">
      </div>

      <div class="mb-3">
        <label class="form-label">Blackout Dates</label>
        <input type="text" class="form-control" id="blackoutDates" placeholder="e.g., 2025-12-24, 2025-12-25...">
      </div>

      <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="maintenanceMode">
        <label class="form-check-label" for="maintenanceMode">
          Temporarily Block Resource (Maintenance)
        </label>
      </div>

      <button type="submit" class="btn btn-primary">Add Resource</button>
    </form>
  </div>

  <div class="card shadow-sm p-4 mt-4">
    <h5>Existing Resources</h5>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Type</th>
            <th>Working Hours</th>
            <th>Maintenance</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="resourceTableBody"></tbody>
      </table>
    </div>
  </div>

</main>

<footer class="footer border-top mt-5 py-3">
  <div class="container text-center">
    <p>Â© 2025 Campus Booking | Concordia University Project</p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Module script -->
<script type="module">
  import { loadRooms } from './js/data.js';

  const tableBody = document.getElementById("resourceTableBody");
  let resources = [];

  async function initResources() {
    try {
      resources = await loadRooms();
      renderResources();
    } catch (err) {
      console.error("Failed to load rooms:", err);
      tableBody.innerHTML = "<tr><td colspan='6' class='text-danger'>Error loading resources.</td></tr>";
    }
  }

  function renderResources() {
    tableBody.innerHTML = "";
    resources.forEach((res, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${res.id}</td>
        <td>${res.title}</td>
        <td>${formatType(res.category)}</td>
        <td>${res.openHours}</td>
        <td><input type="checkbox" class="maintenance-toggle" ${res.availability === "busy" ? "checked" : ""} data-index="${index}"></td>
        <td>
          <button class="btn btn-sm btn-secondary edit-btn" data-index="${index}">Edit</button>
          <button class="btn btn-sm btn-danger delete-btn" data-index="${index}">Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    });

    attachEvents();
  }

  function formatType(t) {
    const map = {
      study_room: "Study Room",
      lab: "Lab",
      sports: "Sports Space",
      equipment: "Specialized Equipment",
      software: "Software Seat"
    };
    return map[t] || t;
  }

  function attachEvents() {
    document.querySelectorAll('.edit-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const i = btn.dataset.index;
        alert(`Edit resource: ${resources[i].title}`);
      });
    });

    document.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const i = btn.dataset.index;
        if (confirm(`Delete ${resources[i].title}?`)) {
          resources.splice(i, 1);
          renderResources();
        }
      });
    });

    document.querySelectorAll('.maintenance-toggle').forEach(chk => {
      chk.addEventListener('change', () => {
        const i = chk.dataset.index;
        resources[i].availability = chk.checked ? "busy" : "available";
        alert(`${resources[i].title} maintenance: ${chk.checked ? "ON" : "OFF"}`);
      });
    });
  }

  document.getElementById('addResourceForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const id = document.getElementById('resourceId').value.trim();
    const name = document.getElementById('resourceName').value.trim();
    const type = document.getElementById('resourceType').value;
    const hours = document.getElementById('workingHours').value.trim();
    const maintenance = document.getElementById('maintenanceMode').checked;

    if (!id || !name || !hours) {
      alert('Please fill in all required fields.');
      return;
    }

    const newResource = {
      id,
      title: name,
      category: type,
      openHours: hours,
      availability: maintenance ? "busy" : "available",
      badgeText: maintenance ? "Under Maintenance" : "Available"
    };

    resources.push(newResource);
    renderResources();
    this.reset();
    alert('Resource added successfully!');
  });

  initResources();
</script>
<script src="js/auth.js"></script>

</body>
</html>
